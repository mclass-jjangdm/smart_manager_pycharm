{% extends "base.html" %}
{% load humanize %}

{% block content %}
<style>
    /* 1. style.cssì— ì—†ëŠ” 4ì—´ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ì •ì˜ */
    .grid-4 {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
    }

    /* 2. ëŒ€ì‹œë³´ë“œ ì „ìš© í…ìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹° */
    .dash-label {
        font-size: 0.9rem;
        color: var(--text-sub);
        font-weight: 600;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    .dash-value {
        font-size: 2rem;
        font-weight: 700;
        line-height: 1.2;
        margin-bottom: 15px;
    }
    .dash-link {
        font-size: 0.9rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        transition: 0.2s;
    }
    .dash-link:hover { text-decoration: underline; }

    /* 3. ì¹´ë“œ í¬ì¸íŠ¸ ì»¬ëŸ¬ (CSS ë³€ìˆ˜ í™œìš©) */
    .card-primary { border-left: 5px solid var(--primary); }
    .card-success { border-left: 5px solid var(--success); }
    .card-danger  { border-left: 5px solid var(--danger); }
    .card-warning { border-left: 5px solid #F59E0B; } /* Warning ì»¬ëŸ¬ëŠ” ë³„ë„ ì§€ì • */

    /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ í—¬í¼ */
    .text-primary { color: var(--primary); }
    .text-success { color: var(--success); }
    .text-danger  { color: var(--danger); }
    .text-warning { color: #F59E0B; }

    /* ë°˜ì‘í˜• ì²˜ë¦¬ */
    @media (max-width: 1024px) {
        .grid-4 { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 768px) {
        .grid-4 { grid-template-columns: 1fr; }
    }
</style>

<!-- í—¤ë” ì„¹ì…˜ -->
<div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px;">
    <div>
        <h2 style="margin: 0; color: var(--text-main);">ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, ê´€ë¦¬ìë‹˜!</h2>
        <p style="margin: 5px 0 0; color: var(--text-sub);">í•™ì› ìš´ì˜ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.</p>
    </div>
    <form action="{% url 'monthly_batch_charge' %}" method="POST" style="margin: 0;">
        {% csrf_token %}
        <!-- style.cssì˜ .btn .btn-primary í´ë˜ìŠ¤ í™œìš© -->
        <button type="submit" class="btn btn-primary" onclick="return confirm('ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œë¥¼ ì¼ê´„ ì²­êµ¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
            ğŸ’° ìˆ˜ê°•ë£Œ ì¼ê´„ ì²­êµ¬
        </button>
    </form>
</div>

<!-- ìƒë‹¨ ìš”ì•½ ì¹´ë“œ (Grid 4) -->
<div class="grid-4" style="margin-bottom: 30px;">
    <!-- ì´ í•™ìƒ ìˆ˜ -->
    <div class="card card-primary">
        <div class="dash-label">Total Students</div>
        <div class="dash-value text-primary">{{ total_students }}ëª…</div>
        <a href="{% url 'student_list' %}" class="dash-link text-primary">
            í•™ìƒ ê´€ë¦¬ <span style="font-size: 1.1em;">â†’</span>
        </a>
    </div>

    <!-- ì´ êµì‚¬ ìˆ˜ -->
    <div class="card card-success">
        <div class="dash-label">Total Teachers</div>
        <div class="dash-value text-success">{{ total_teachers }}ëª…</div>
        <a href="{% url 'teacher_list' %}" class="dash-link text-success">
            êµì‚¬ ê´€ë¦¬ <span style="font-size: 1.1em;">â†’</span>
        </a>
    </div>

    <!-- ë¯¸ë‚© ìˆ˜ê°•ë£Œ -->
    <div class="card card-danger">
        <div class="dash-label">Unpaid Tuition</div>
        <div class="dash-value text-danger">{{ total_unpaid|intcomma }}ì›</div>
        <a href="{% url 'student_list' %}" class="dash-link text-danger">
            ë¯¸ë‚©ì í™•ì¸ <span style="font-size: 1.1em;">â†’</span>
        </a>
    </div>

    <!-- í’ˆì ˆ ë„ì„œ -->
    <div class="card card-warning">
        <div class="dash-label">Out of Stock</div>
        <div class="dash-value text-warning">{{ out_of_stock_count }}ì¢…</div>
        <a href="{% url 'book_list' %}" class="dash-link text-warning">
            ì¬ê³  ì…ê³  <span style="font-size: 1.1em;">â†’</span>
        </a>
    </div>
</div>

<!-- í•˜ë‹¨ ìƒì„¸ ì •ë³´ (Grid 2 - style.cssì— ì •ì˜ëœ í´ë˜ìŠ¤) -->
<div class="grid-2">
    <!-- ì¬ê³  ë¶€ì¡± ì•Œë¦¼ -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 10px;">
            <h3 style="margin: 0; font-size: 1.1rem;">âš ï¸ ì¬ê³  ë¶€ì¡± ì•Œë¦¼ <small style="color: var(--text-sub); font-weight: normal;">(5ê¶Œ ì´í•˜)</small></h3>
            <a href="{% url 'book_list' %}" class="btn-sm btn-outline">ì „ì²´ë³´ê¸°</a>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>ë„ì„œëª…</th>
                        <th style="text-align: right;">í˜„ì¬ê³ </th>
                        <th style="text-align: center;">ìƒíƒœ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in low_stock_books %}
                    <tr>
                        <td style="font-weight: 500;">{{ book.title }}</td>
                        <td style="text-align: right; font-weight: bold; color: var(--danger);">{{ book.stock }}ê¶Œ</td>
                        <td style="text-align: center;">
                            <!-- style.cssì˜ badge í´ë˜ìŠ¤ í™œìš© -->
                            <a href="{% url 'book_restock' book.pk %}" class="badge badge-red">ì…ê³ í•„ìš”</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" style="text-align: center; padding: 20px; color: var(--text-sub);">
                            ì¬ê³  ë¶€ì¡± ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ìµœê·¼ ì„œì  í™œë™ -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 10px;">
            <h3 style="margin: 0; font-size: 1.1rem;">ğŸ•’ ìµœê·¼ ì„œì  í™œë™ ë¡œê·¸</h3>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th style="width: 30%;">ì‹œê°„</th>
                        <th>ë„ì„œëª…</th>
                        <th style="text-align: right;">ë‚´ì—­</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in recent_logs %}
                    <tr>
                        <td style="color: var(--text-sub); font-size: 0.9rem;">{{ log.created_at|date:"m-d H:i" }}</td>
                        <td style="font-weight: 500;">{{ log.book.title }}</td>
                        <td style="text-align: right;">
                            {% if log.quantity > 0 %}
                                <span class="badge badge-green">ì…ê³  +{{ log.quantity }}</span>
                            {% else %}
                                <span class="badge badge-red">ë°˜í’ˆ {{ log.quantity }}</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" style="text-align: center; padding: 20px; color: var(--text-sub);">
                            ìµœê·¼ í™œë™ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}