{% extends "base.html" %}
{% load humanize %}

{% block content %}
<div style="max-width: 700px; margin: 0 auto;">
    <div style="border-bottom: 2px solid #e53935; margin-bottom: 20px; padding-bottom: 10px;">
        <h2 style="color: #e53935;">ğŸ”™ êµì¬ ë°˜í’ˆ ì²˜ë¦¬</h2>
        <p style="color: #666; margin: 0;">
            <strong>{{ book.title }}</strong> (í˜„ì¬ ì¬ê³ : <span style="color: #e65100; font-weight: bold;">{{ book.stock }}</span>ê¶Œ)
        </p>
    </div>

    <div class="info-card" style="padding: 30px; border-top: 4px solid #e53935;">
        <form method="POST">
            {% csrf_token %}

            <div style="background-color: #ffebee; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #c62828;">
                <strong>âš ï¸ ì£¼ì˜:</strong> ë°˜í’ˆ ì²˜ë¦¬ ì‹œ ì¬ê³ ê°€ ì¦‰ì‹œ ê°ì†Œí•©ë‹ˆë‹¤.
            </div>

            <div style="margin-bottom: 20px;">
                <label for="id_supplier" style="font-weight: bold;">ğŸ¢ ë°˜í’ˆì²˜ (êµ¬ë§¤ì²˜)</label>
                {{ form.supplier }}
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label for="id_quantity"><strong>ë°˜í’ˆ ìˆ˜ëŸ‰</strong></label>
                    {{ form.quantity }}
                </div>
                <div>
                    <label for="id_cost_price">ë°˜í’ˆ ë‹¨ê°€ (í™˜ë¶ˆì•¡)</label>
                    {{ form.cost_price }}
                </div>
            </div>

            <div style="background-color: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p style="margin: 0 0 10px 0; font-weight: bold; color: #666;">ğŸ’¸ í™˜ë¶ˆ(ì •ì‚°) ì •ë³´</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <label for="id_total_payment">ì´ í™˜ë¶ˆì•¡ (ìë™ê³„ì‚°)</label>
                        {{ form.total_payment }}
                    </div>
                    <div>
                        <label for="id_payment_date">ë°˜í’ˆ ë‚ ì§œ</label>
                        {{ form.payment_date }}
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <label for="id_memo">ë¹„ê³  (ì‚¬ìœ )</label>
                {{ form.memo }}
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button type="submit" class="btn" style="background-color: #e53935; padding: 10px 40px; font-size: 1.1rem;">
                    ë°˜í’ˆ í™•ì •
                </button>
                <a href="{% url 'book_list' %}" class="btn" style="background-color: #757575; margin-left: 10px;">ì·¨ì†Œ</a>
            </div>
        </form>
    </div>

    <h4 style="margin-top: 40px; color: #666;">ğŸ•’ ìµœê·¼ ì¬ê³  ë³€ë™ ì´ë ¥</h4>
    <table style="font-size: 0.9rem;">
        <thead>
            <tr>
                <th>ë‚ ì§œ</th>
                <th>êµ¬ë¶„</th>
                <th>ìˆ˜ëŸ‰</th>
                <th>ë¹„ê³ </th>
            </tr>
        </thead>
        <tbody>
            {% for log in recent_logs %}
            <tr>
                <td>{{ log.created_at|date:"Y-m-d H:i" }}</td>
                <td>
                    {% if log.quantity > 0 %}
                        <span style="color: #2e7d32; font-weight: bold;">ì…ê³ </span>
                    {% else %}
                        <span style="color: #e53935; font-weight: bold;">ë°˜í’ˆ</span>
                    {% endif %}
                </td>
                <td>{{ log.quantity }}</td>
                <td>{{ log.memo|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="4" style="text-align: center; color: #999;">ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const quantityInput = document.getElementById('id_quantity');
        const priceInput = document.getElementById('id_cost_price');
        const totalInput = document.getElementById('id_total_payment');

        function calculateRefund() {
            const qty = parseInt(quantityInput.value) || 0;
            const price = parseInt(priceInput.value) || 0;
            totalInput.value = qty * price;
        }

        quantityInput.addEventListener('input', calculateRefund);
        priceInput.addEventListener('input', calculateRefund);
    });
</script>
{% endblock %}