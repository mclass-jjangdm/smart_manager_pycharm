{% extends "base.html" %}
{% load humanize %}

{% block container_class %}wide-screen{% endblock %}

{% block content %}
<style>
    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ ê°•í™” */
    .year-table th, .year-table td {
        border: 1px solid #ddd;
        padding: 8px 5px; /* ì¢Œìš° íŒ¨ë”©ì„ ì¤„ì—¬ì„œ 12ê°œì›”ì´ ë‹¤ ë“¤ì–´ê°€ê²Œ í•¨ */
        font-size: 0.9rem;
    }
    .year-table th {
        background-color: #f3e5f5; /* ì—°í•œ ë³´ë¼ìƒ‰ */
        text-align: center;
        color: #4527a0;
    }
    .year-table td.amount {
        text-align: right;
    }
    .year-table tr:hover {
        background-color: #fafafa;
    }
    /* í•©ê³„ í–‰/ì—´ ìŠ¤íƒ€ì¼ */
    .total-col {
        background-color: #fff3e0;
        font-weight: bold;
        color: #e65100;
    }
    .total-row td {
        background-color: #e8eaf6;
        font-weight: bold;
        color: #1a237e;
        border-top: 2px solid #3f51b5;
    }
</style>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>ğŸ“… {{ selected_year }}ë…„ ì—°ê°„ ê¸‰ì—¬ ëŒ€ì¥</h2>

    <div style="display: flex; gap: 15px; align-items: center;">
        <form method="GET" style="display: flex; align-items: center; gap: 10px;">
            <label style="font-weight: bold;">ì—°ë„ ì„ íƒ:</label>
            <select name="year" onchange="this.form.submit()" style="padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                {% for y in year_range %}
                <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}ë…„</option>
                {% endfor %}
            </select>
        </form>

        <a href="{% url 'teacher_payroll' %}" class="btn" style="background-color: #757575;">
            â† ì›”ë³„ ê¸‰ì—¬ ê´€ë¦¬ë¡œ
        </a>
    </div>
</div>

<div style="overflow-x: auto;">
    <table class="year-table">
        <thead>
            <tr>
                <th style="min-width: 80px; position: sticky; left: 0; background-color: #f3e5f5; z-index: 1;">êµì‚¬ëª…</th>
                <th>1ì›”</th>
                <th>2ì›”</th>
                <th>3ì›”</th>
                <th>4ì›”</th>
                <th>5ì›”</th>
                <th>6ì›”</th>
                <th>7ì›”</th>
                <th>8ì›”</th>
                <th>9ì›”</th>
                <th>10ì›”</th>
                <th>11ì›”</th>
                <th>12ì›”</th>
                <th class="total-col">í•©ê³„</th>
            </tr>
        </thead>
        <tbody>
            {% for row in report_data %}
            <tr>
                <td style="font-weight: bold; position: sticky; left: 0; background-color: white;">
                    {{ row.teacher.name }}
                </td>

                {% for amount in row.monthly_amounts %}
                <td class="amount">
                    {% if amount > 0 %}
                        {{ amount|intcomma }}
                    {% else %}
                        <span style="color: #ddd;">-</span>
                    {% endif %}
                </td>
                {% endfor %}

                <td class="amount total-col">
                    {{ row.row_total|intcomma }}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="14" style="text-align: center; padding: 30px; color: #999;">
                    {{ selected_year }}ë…„ë„ ì§€ê¸‰ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
                </td>
            </tr>
            {% endfor %}
        </tbody>

        {% if report_data %}
        <tfoot>
            <tr class="total-row">
                <td style="text-align: center; position: sticky; left: 0; background-color: #e8eaf6;">ì›”ê³„</td>

                {% for total in monthly_totals %}
                <td class="amount">
                    {{ total|intcomma }}
                </td>
                {% endfor %}

                <td class="amount" style="color: #d32f2f; background-color: #ffccbc;">
                    {{ grand_total|intcomma }}
                </td>
            </tr>
        </tfoot>
        {% endif %}
    </table>
</div>
{% endblock %}